name: Deploy Hugging Face Space

on:
  push:
    branches:
      - main 

permissions:
  contents: write

jobs:
  sync-space:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Set up Python 3.x
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install Hugging Face Hub
        run: pip install huggingface-hub

      # --- NOVO PASSO: Adiciona o diretório de executáveis do pip ao PATH ---
      # O $HOME é uma variável de ambiente que aponta para o diretório do usuário.
      # Este comando adiciona o diretório de binários de instalação do pip ao PATH.
      - name: Add User Bin to PATH
        run: echo "$HOME/.local/bin" >> $GITHUB_PATH
        # Force a execução em um novo shell para garantir a atualização
        shell: bash

      - name: Sync to Hugging Face Space using hf-cli (FINAL)
        env:
          HF_TOKEN: ${{ secrets.HF }}
          REPO_ID: willp01/projeto001
        run: |
          # Agora o comando 'huggingface-cli' será encontrado!
          huggingface-cli login --token $HF_TOKEN

          huggingface-cli create-repo $REPO_ID --type space --space-sdk gradio || echo "Repo already exists"

          huggingface-cli upload $REPO_ID . --include "*" --exclude ".git*"
      
           # Comando de upload (pode ser o que está causando o erro, use o módulo)
          python -m huggingface_hub upload $REPO_ID . --include "*" --exclude ".git*"
  
