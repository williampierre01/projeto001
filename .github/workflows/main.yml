name: Deploy Hugging Face Space

# O workflow será acionado em todo push para a branch 'main'.
on:
  push:
    branches:
      - main 

# Define permissão de escrita para o checkout e sincronização.
permissions:
  contents: write

jobs:
  sync-space:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout do seu repositório GitHub
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      # 2. Configura o Python
      - name: Set up Python 3.x
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # 3. Instala a biblioteca Hugging Face Hub
      - name: Install Hugging Face Hub
        run: pip install huggingface-hub

      # 4. Sincroniza o repositório, usando o caminho do ambiente virtual
      - name: Sync to Hugging Face Space using hf-cli
        env:
          HF_TOKEN: ${{ secrets.HF }}
          REPO_ID: willp01/projeto001 # Seu Space ID
        run: |
          # 1. Define o caminho mais provável (ambiente virtual)
          HF_CLI_PATH="${{ env.pythonLocation }}/bin/huggingface-cli"
          
          echo "Caminho CLI tentando: $HF_CLI_PATH"
          
          # 2. Testa e executa
          if [ -f "$HF_CLI_PATH" ]; then
            echo "Executável encontrado. Iniciando a sincronização..."
            
            # Faz login no Hugging Face
            $HF_CLI_PATH login --token $HF_TOKEN

            # Cria o repositório (se não existir)
            $HF_CLI_PATH create-repo $REPO_ID --type space --space-sdk gradio || echo "Repo already exists"

            # Sincroniza os arquivos locais para o Space.
            $HF_CLI_PATH upload $REPO_ID . --include "*" --exclude ".git*"
          else
            # 3. Solução de fallback caso o caminho 'bin' falhe (comum em alguns ambientes Python)
            # Tenta o caminho de usuário (que você já tentou)
            FALLBACK_PATH="$HOME/.local/bin/huggingface-cli"
            
            if [ -f "$FALLBACK_PATH" ]; then
              echo "Executável encontrado no caminho de fallback: $FALLBACK_PATH"
              # Executa usando o fallback
              $FALLBACK_PATH login --token $HF_TOKEN
              $FALLBACK_PATH create-repo $REPO_ID --type space --space-sdk gradio || echo "Repo already exists"
              $FALLBACK_PATH upload $REPO_ID . --include "*" --exclude ".git*"
            else
              echo "Erro crítico: O executável hf-cli não foi encontrado em nenhum local padrão ($HF_CLI_PATH ou $FALLBACK_PATH)."
              echo "Recomendação: Execute 'pip show huggingface-hub' em um step de debug para ver o caminho de instalação real."
              exit 1
            fi
          fi
